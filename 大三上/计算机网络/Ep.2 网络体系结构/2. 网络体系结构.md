# Ep.2 网络体系结构

网络体系复杂体现在以下方法：

* 通信介质不同：电子/光
* 链路不同：光纤、铜线、卫星等
* 交换复杂：机械(人工服务)、电、光、交叉
* 协议：TCP/IP、ATM、Ethernet、PPP、X.25、FrameRelay、AppleTalk、IPX等
* 功能复杂：
  * Routing - 路由（走什么线路、什么时候上下线路等）
  * Error Control - 差错控制（要求传输无差错）
  * Congestion Control - 拥塞控制（防止网络阻塞）  
    瘫痪原因：资源耗尽（路由器的内存耗尽）
  * Quality of Service(QoS) - 服务质量（需要保证服务质量）
* 应用：FTP、WEB、远程桌面、虚拟化（机器整合再划分、用以提升系统稳定性）

**网络体系结构是层次和协议的结合。**

## 一、基本概念

### 1. 分层

正因为网络非常复杂，需要划分成小的子系统来处理，即分层。  
分层原因：

* 在对等层之间建立通信关系
* 简化软件的编写、调试、修改
* 修改某层不影响其他层
* 容易标准化、开放式

分层的标准：

* 根据不同层次的抽象分层，每层应当实现一个定义明确的功能
* 每层的功能及技术实现应有明显差别，交界面的相互作用要少（低耦合）
* 低层对于高层是透明的  
  > 透明：高层不知道低层的具体实现。
* 每层功能的选择应该有助于指定网络协议的国际标准
* 层次数目要适当。要足够多避免不同功能混杂在一层；也不能太多避免体系结构庞大
* 考虑现有的网络结构及通信协议（不能废弃当前别人的投资）

### 2. 协议

> 定义 - 协议：
>
> 通信的关键是通信双方能够互相理解。  
> 对于人类语言需要规定：讲什么、如何将、谁先谁后讲  
> 对于计算机网络：报文含义、报文格式、发送顺序
>
> 对于上述规则的约定则是协议。

![协议的举例](images/2.%20%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84--09-21_10-30-08.png)  
左侧是人类对话的过程，右侧则是计算机网络模仿人类对话的过程。

协议三要素：

* 语义
* 语法
* 协议

协议的必要性：

* 硬件只负责低层（只负责数据收发）
* 但可能发成问题
  * 比特出错
  * 报文丢失
  * 重复报文
  * 报文传递顺序
* 因此需要采取措施（指定协议）处理
  * 一台网络连接多台计算机
  * 同一计算机运行多个应用进程
  * 同一计算机的一个应用具有多个拷贝

*注：协议不止网络上，如串口通信(COM)也有协议。*

多个协议可以组成一个协议集，多个协议一起工作，各自解决不同的问题。

### 3. 对等层？

![图 2](images/2.%20%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84--09-21_10-45-58.png)

数据不是从一台机器的$n$层直接传到另一台机器的$n$层，而是把数据和控制信息层层下传，直到最低层，  
最低层是物理介质，所有数据通信都在该层的基础上进行。

![传输举例](images/2.%20%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84--09-21_10-50-51.png)  
一台机器发送时，将信息层层打包，传到路由器；路由器发送后，另一台计算机层层解封，得到数据。

## 二、具体分层

### 1. 物理层

要连接两台计算机，必须解决一下问题：

* 机械特性 - 采用什么样的通信接口（串/并/网络）  
  规定物理连接时所使用可接插连接器的形状和尺寸、引脚的数量与排列情况等
* 功能特性 - 通信接口如何定义（数据、控制、定时、定地）  
  规定各引脚有什么用。  
  如：**9针**的接口(DB-9)的**2,3,5为发送、接受、地**；**25针**的接口(DB-25)的**2,3,7为发送、接受、地**）  
  其他一些技术：
  * 交叉连接：双方交叉连接2和3，5（或7）公用。
  * 单串口调试：把2、3短路。
* 电气特性 - 信号电平、比特宽度、连接距离、信道编码
  * 数字信号
  * 控制信号和数据
  * 负逻辑：`1` - $-3v\sim -15v$ / `0` - $3V \sim 15v$
  * 信号速率
  * 连接距离
  * 控制信号：`on` / `off`
* 规程特性 - 事件之间的时序关系。  
  ![工作规则和时序](images/2.%20%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84--09-21_11-17-25.png)

这些内容都是物理相关的，故需要**引入物理层**。  
在没有差错的情况下，只要保证遵守以上四个特性，就能保证信号的可靠传输（接什么发什么）。

### 2. 数据链路层

物理层仍存在没有解决的问题：

* **差错控制** - 信道一般存在误码率
* **定义传输信号具体含义** - 物理层只管传送比特信号，不关心信号含义
* **流量控制** - 两台机器速率不匹配，快的发送可能讲慢的接受淹没

故划分出数据链路层，解决上述问题。  
则数据链路层的主要功能：

* 信息含义（帧格式）的定义、帧定界  
  ![图 5](images/2.%20%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84--09-21_11-36-56.png)  
  将以太网帧定为如下格式：  
  ![图 6](images/2.%20%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84--09-21_11-41-31.png)  
  *FCS - 4字节校验和*
* 流量控制 - 避免快的发送淹没慢的接受  
  * 停等协议（停下来等接受完）
  * 滑动窗口协议
  * 其他流量控制协议
* 差错控制 - 错误检测、确认（捎带应答）、重传
* 共享信号 - 介质访问控制（MAC）

即确保数据（帧）在链路（同一个子网）的可靠传输。

### 3. 网络层

链路层只是负责在同一个物理网络下（内网）的数据传输，  
要解决**跨网传输**，需要引入网络层。

主要功能：确保分组在通信子网内（从源IMP到目的IMP之间）的传输。

解决问题：

* 编址 - IP、域名、MAC（物理地址）
* 地址转换 - 上三者相互转换、NAT  
  外网不知道内网地址，绑定IP和MAC；不容易记住外网地址，绑定IP和域名。  
  NAT：内网共享外网地址（如热点、路由器）
* 分组转发和路由选择
* 拥塞控制
* 网际互连
* 差错检测与恢复
* 多路广播
* 记账服务

### 4. 传输层

![图 7](images/2.%20%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84--09-21_11-52-47.png)  
在传具体内容时，传输层拆分成若干段，再由网络层无序传输。

把完整的报文发送到对方主机的某个进程。

解决问题：

* 报文分组：Msg→Packet→Msg
* 连接管理（建立连接、传输数据、释放连接）
* 寻址(Addressing)与多路复用：绑定IP和端口
* 流量控制/拥塞控制：终端/网络端
* 差错控制：由终端（主机）完成

### 5. 会话层

传输层及以下各层主要负责网络数据通信，  
而网络最终目的是用户之间的通信——会话，  
为解决用户之间的会话问题引入会话层。

功能：

* 会话管理（建立、维护、释放会话）
* ……

### 6. 表示层

有关用户信息的表达以及网络安全性的问题，集中放在表示层处理。  
（如账号密码等需要处理的信息）

重要功能：

* 抽象语法描述
* 编码规则
* 数据压缩/解压缩
* 加密/解谜

### 7. 应用层

计算机网络上的应用多种多样，需要规范这些应用，  
使之成为开放式应用，应用之间能够实现互连。

应用层向应用程序提供服务，解决通用性应用问题。  
服务按其向应用程序**提供的特性**分组，称为**服务元素**。

* 文件传输：TFP/TFTP
* 电子邮件：SMTP, POP3/IMAP
* 网上浏览：HTTP, HTTPS
* 终端仿真：Telnet
* 无盘工作站
* 简单网络管理协议：SNMP
* 目录服务：LDAP, AD