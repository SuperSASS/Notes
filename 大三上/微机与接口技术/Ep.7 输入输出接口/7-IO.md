# Ep.7 输入输出接口

所有的外设都要通过输入输出接口与计算机相连。

## 一、概述

CPU 与外设通过接口交换的信息有：

* 数据信息
* 状态信息
* 控制信息

**主要功能：**

* 对输入输出数据进行**缓冲和锁存**
* 对信号的形式和数据的格式进行**变换**
* 对I/O端口进行**寻址**
* 提供**联络信号** - 发出请求、接收响应

**I/O接口的结构：**

* 数据端口：输入输出数据
* 状态端口
* 控制端口

### 4. 寻址方式

1. 统一编址  
   存储单元和I/O端口的地址统一编址，把I/O端口和存储单元看作类似的，操作也类似。
   * 优点
     * 指令丰富，可以直接像对存储器一样操作（如移位）
     * 内存和外设的地址分布图是同一个
     * 不需要专门的输入输出指令，区分是外设还是存储区
   * 缺点
      * 存储容量减少
2. 分开编址  
   CPU有专门的I/O指令，要用地址来区分不同的外设。  
   8086中即采用分开编址，以端口(Port)作为地址单元。
   * 优点
     * 不占用存储器地址
     * 有单独的I/O指令，容易区分
   * 缺点
     * 单独I/O指令功能有限
     * 采用专用的I/O时序和控制逻辑

## 二、常用I/O接口芯片

### 1. 锁存器 - 74LS373

为8位（8个数据输入和输出端）

* 输入使能端$G$
* 数据输入端$D$
* 输出使能端$\overline{OE}$
* 数据输出端$Q$

当使能端$G$有效时，将输入端$D$的内容进行锁存；
当$\overline{OE}$有效时，将锁存的内容输出到$Q端；否则$Q$端为高阻态。

### 2. 缓冲器 - 74LS244

即要么输出，要么高阻。

* 输入端$1A_1\sim 1A_4$、$2A_1\sim 2A_4$
* 输出端$1Y_1\sim 1Y_4$、$2Y_1\sim 2Y_4$
* 使能端$\overline{1G},\overline{2G}$

$\overline{1G}$为低电平时，$1Y_1\sim 1Y_4$与对应输入相同；否则输出高阻态。  
$\overline{2G}$同理。

## 三、CPU与外设之间数据传送的方式

一般有4种：

* 程序控制方式
* 中断方式
* 直接存储器存取方式
* 通道控制方式

### 1. 程序控制方式

状态和数据的传输**由CPU执行一系列指令**完成。  
数据传输过程中，要么由CPU查询外设状态，要么由外设向CPU发出请求。

分为：

* 无条件传输方式  
  CPU不用了解外设状态，直接传输数据。适用于开关、二极管等简单结构。
* 条件传输方式（程序查询方式）  
  CPU在传输数据前，需要先检查外设状态，满足就绪条件才进行传输。
  * CPU从接口读取状态字
  * CPU检测状态字的相应位，是否满足就绪条件，不满足转1，否则继续。
  * 如果状态位表明外设已处于就绪状态，则传输数据。
  
### 2. 中断方式

### 3. 直接存储器存取(DMA)方式

在系统中建立一种机制，将外设与内存之间建立起直接的通道，  
CPU不再直接参加外设与内存间的数据传输，而是将地址总线、数据总线及控制总线的管理权交给DMA控制单元，  
在传输完成后再收回权限。

### 4. 通道方式

早期存在类似于CPU的内部通道，称为通道控制器，  
CPU只需要通知打开通道，其他事务由通道控制器处理。
