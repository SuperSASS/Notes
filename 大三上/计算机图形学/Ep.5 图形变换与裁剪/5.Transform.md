# Ep.5 图形变换与裁剪

## 一、基础知识

### 1. 坐标系

* 世界坐标系  
  场景中所有图形对象的空间定位和定义。  
  对于三维图形注意左右手坐标系。
* 建模（局部）坐标系  
  就是图形内部用的坐标系，定图形内一原点，描述图形内各端点等信息。
* 用户坐标系
* 观察坐标系  
  用户坐标系中自己实际观察到的部分。
* 设备坐标系  
  图形输入输出系统设备的坐标系，需要最终把其他坐标系映射到设备坐标系绘制出来。

### 2. 向量和矩阵

* 向量
  * 点积（求$\cos\theta$）
  * 叉积
* 矩阵
  * 运算（加减乘）
  * 单位运算
  * 转置
  * 求逆
* 齐次坐标
  * 定义：$n$维向量的点，用$n+1$维表示$(hn_1,hn_2,hn_3,\cdots,hn_n,h)$

### 3. 图形表示

* 点
* 点集矩阵：若干点构成的集合。  
  可用齐次矩阵表示点积矩阵。

对于图形变换，则是图形的旧点集，乘上变换矩阵，得到新点集。

## 二、二维图形基本变换

以下坐标的变换，可以转换为变换矩阵相乘的形式，得到**变换矩阵**。  
规定以下坐标向量为**行向量**（系数写到变换矩阵的列上）。

基本变换：以坐标原点作为参考点，坐标轴作为参考方向。

### 1. 平移变换

对象沿直线路径，从一个坐标位置移动到另一个坐标位置的重定位过程。  
不产生形变，只移动物体，是刚体变换。

$P(x,y)$在$x$方向移动$T_x$、$y$方向移动$T_y$，称$T_x,T_y$为移动矢量。

**坐标形式：**

$$
x'=x+T_x \\
y'=y+T_y
$$

**矩阵形式：**

### 2. 缩放变换

对象相对于**坐标原点**，沿$x$方向和$y$方向放大或缩小的变换。

$P(x,y)$在$x$方向放大或缩小$S_x$、$y$方向放大缩小$S_y$。

**坐标形式：**

$$
x'=x\cdot S_x\\
y'=y\cdot S_y
$$

**矩阵形式：**


对于$S_x=S_y$时，称为均匀变换、等比例变换；  
而不等于时，图形沿坐标轴方向做非均匀缩放，会发生形变；  
若$S_x<0$或$S_y<0$，不仅大小发生变换，坐标还会发成对称变换。

对于等比例变换，称$\frac{1}{S}$为比例系数。

### 3. 旋转变换

将图形对象**绕坐标原点**转动某个角度$\theta$（逆时针为正），得到新的图形对象的重定位过程。

$P(x,y)$，记距原点距离为$r$，与$x$轴夹角$\alpha$，则极坐标：

$$
x=r\cos\theta \\
y=r\sin\theta
$$

绕原点旋转$\theta$后，  
**坐标形式：**

$$
x'=x\cos\theta - y\sin\theta \\
y'=x\sin\theta + y\cos\theta
$$

**矩阵形式：**

逆变换就是角度$\theta$取反即可。

### 4. 对称变换

指图形对象关于坐标轴、原点、$\pm45\degree$线的镜像，得到新的图形都喜爱难过。

关于$x$轴的对称变换：

**坐标形式：**

$$
x'=x \\
y'=-y
$$

---

关于$y$轴的对称变换：

**坐标形式：**

$$
x'=-x \\
y'=y
$$

---

关于坐标原点的对称变换：

**坐标形式：**

$$
x'=-x \\
y'=-y
$$

---

关于$y=x$的对称变换：

**坐标形式：**

$$
x'=y \\
y'=x
$$

---

关于$y=-x$的对称变换：

**坐标形式：**

$$
x'=-y \\
y'=-x
$$

### 5. 错切变换

也称剪切、错位或错移变换，用于产生弹性物体的变型处理。  
相当于对物体施加若干力（推力、摩擦力）而产生形变。

沿$x$轴方向关于$y$的错切：

记$\alpha$为错切角度。

**坐标形式：**

$$
x'=x+\tan\alpha y \\
y'=y
$$

---

沿$y$轴方向关于$x$的错切：

---

$x,y$方向均有错切变换。

### 6. 二维仿射变换

上述变换均为二维仿射变换。

$$
x' = ax+by+c \\
y' = dx+ey+f
$$

性质：

* 直线中点不变性
* 平行直线不变形
* 旋转 - 保持线性关系和角度关系
* 错切 - 引起角度关系的改变，甚至导致图形畸变
* 仅包含旋转、平移和对称 - 角度和长度不变
* 拓扑不变的几何变换，不改变图形的连接关系和平行关系。

变换矩阵可以划分为四个子阵：

* 左上$2\times2$ - 实现比例、旋转、对称和错切
* 左下$1\times2$ - 平移
* 右上$2\times1$ - 投影（二维图形不用）
* 右下$1\times1$ - 整体比例变换

## 三、二维图形复合变换

### 1. 连续平移变换

系数相加。

### 2. 连续比例变换

系数相乘。

### 3. 连续旋转变换

角度相加。

## 四、二维图形一般和任意变换

### 1. 一般变换

变换基准不同于基本变换，**基准点**不再是坐标原点。  
但参考方向仍是坐标轴。

即相对于任意参考点$(x_r,y_r)$作比例、旋转等几何变换。

方法：

1. 平移  
   将要变换的图形连同参考点作相同的平移，使参考点$(x_r,y_r)$**平移到坐标原点**$(0,0)$。
2. 进行基本变换
3. 平移回去

### 2. 任意变换

基准点和参考方向均不同。

即相对于任意参考线$(x_r,y_r)$、任意参考方向$\theta$轴作集合变换。

方法：

1. 平移
2. 旋转  
   将参考方向旋转到与$x$重合。
3. 进行基本变换
4. 旋转回去
5. 平移回去

### 3. 任意对称变换

关于直线$ax+by+c=0$进行对称。

可得到：

* 在$x$轴截距：$-\frac{c}{a}(a\ne0)$
* 在$y$轴截距：$-\frac{c}{b}(b\ne0)$
* 与$x$轴夹角：$\theta=\arctan(-\frac{a}{b})$

思路：把对称轴变为基本的对称轴，如$x$轴。

方法：

1. 平移  
   把图形对象和轴线一起平移，使对称轴线通过坐标原点
2. 旋转  
   一起旋转，使得轴线与$x$轴重合
3. 对称变换
4. 逆旋转  
5. 逆平移

### 4. 坐标系变换

把图形对象从一个坐标系$xOy$中的描述，变换到另一个坐标系$x'Oy'$。

知道$x$轴与$x'$轴的夹角$\theta$，  
$O'$在$xOy$中的坐标$(x_0,y_0)$。

方法：

1. 平移至坐标原点  
   将图形对象同$O'$平移至$O$，使两坐标系重合
2. 旋转至坐标轴
   将图形对象同$x'$轴旋转至与$x$重合。

则图形对象上的原坐标，乘上上述两步的系数矩阵，可以得到新坐标系下的坐标。