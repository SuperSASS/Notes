# Ep.3 LRM 设计 - 语法

## 1. 语言的字符集

为了定义程序的形式，一个语言必须选定一个基本的字符集合。

如 Unicode。

## 2. 词法元素

* 标识符
  * 语言里的关键字：有特殊意义的标识符，如`if`  
  * 保留字：目前没有实际意义，但以后可能有，不允许程序员用于其他用途
  * 运算符：语义是语言定义的操作
  * 分隔符：空格

## 3. 词法、词法分析

编译第一部就是词法分析。
*相对简单，就做分词*。

* 通常采用“最常可能原则”  
  如`x+++y` -> `x ++ + y`

**词法分析器**：  
从输入中逐个读取字符，输出为词法单元的流，  
其中词法单元由一个终结符号、以及以属性值形式出现的附加信息组成。

## 4. 语法分析

语法规定了词法层次之上的层次结构：

* 表达式的合法结合
* 基本语句的结构，组合语句的构成方式
* 更上层的结构，如子程序、模块的构成

语法用于确定一个输入序列是否**合法**。

**合法性问题**：

1. 局部结构：如括号是否匹配
2. 上写文关系：变量使用前是否定义
3. 深层问题：变量是否初始化

语言的语法定义通常只描述 1（上下文无关部分）；  
编译程序检查 1 和 2（2 可称为“静态语义”）。

**语法分析器**。

**语法翻译**：

* 自顶向下（产生式）
* **自底向上（归约式）**
* 语法树

## 语言与文法

语言就是字符集排列组合的所有可能性。  
语言表示无穷的串，但字符集是有穷的。

**文法**：

表达了一个产生符合语法的语言的**规则**，表示为：

$$
G=(S,N,T,P)
$$

* $S$是起始符号串
* $N$是非终结符号的有限集
* $T$是终结符号的有限集
* $P$是产生式，一般为：
  $$
  \alpha\to\beta|\gamma|\cdots
  $$

  表示可以由$\alpha$产生$\beta,\gamma$等

**文法类型**：

* L0 - 递归可枚举语言
* L1 - 上下文相关语法  
  一个符号在不同环境有不同环境，故可能有二义性、解释不清
* L2 - 上下文无关语法  
  符号最终一定能被翻译，对应一般高级程序语言
* L3 - 正则文法  
  对应汇编语言

## 自动机

* 自动机
* 确定有穷自动机(DFA)  
  转移函数$\delta$的输出是 Q 的某个状态（转移状态确定）
* 正则语言  
  与 DFA 有对应关系
* 非确定有穷自动机(NFA)  
  转移函数$\delta$的输出是 Q 的一个子集合（转移状态不确定）  
  与 DFA 等价：可以拆分为 DFA
* 正则表达式  
  与 NFA 由密切关系

## NBF, EBNF

类似于一种扩充的正则表达式。

**语法图**。

## 属性文法

属性文法可以描述程序设计语言的更多信息。  
是 L2 文法的扩展，可以描述语言规则，如类型兼容性。  
可以描述 BNF 中很困难甚至无法定义的例子（如所有变量在引用前必须声明）。

属性文法定义了**静态语义**。

添加了：

* 属性：综合属性、继承属性
* 属性计算
* 谓词函数