# 线段求交

任务：

给定$n$个线段，求所有交点。并且应该知道交点的信息：哪几个线段交于这个点。

* 基本退化情况(degenerate cases)：
  1. 交于端点
  2. 有线段重合
* 算法：扫描线算法(Bentley and Ottmann)  
  对于该算法还存在一种退化情况：如果扫描线沿y轴从下往上扫，则不能出现水平的线。

## 扫描线算法

*暴力算法：两两求交，$O(n^2)$*

定义 - 状态：扫描线与所有线段的交点与排列关系。

核心思想：

1. 避免对所有线段求交  
   当状态发生改变后，再进行求交即可。  
   并且不用两两求交，只用相邻对求交即可。

实现：

1. 无法实际用扫描点扫。  
   利用事件驱动，对线段按$y$值排序，然后构造事件队列。每次弹出一个，作为“状态改变”这个事件。
2. 要把交点再次加入到事件队列中。  
   1. 如果直接就报告该交点，会导致信息不全（可能多个线交于这个点）
   2. 经过交点，也需要调整“Statae”
3. 事件队列里点的类别：
   1. 上端点：新加入的
   2. 交点
   3. 下端点
4. 对相邻线段对进行求交  
   可能存在重复添加情况，故只将在扫描线下方的加进去（代表新加入）

**数据结构**：

* 事件队列$\mathcal{E}$：堆/平衡二叉树
* 扫描线状态：平衡二分查找树

## 应用 - 区域求交

对于两个由多个多边形定义的区域，要进行融合。

则就是所有线段求交点，然后进行融合。

## 拓展 - 数据结构 - 半边数据结构(Halfedge Data Structure)

用来描述 mesh 的。
传统的：描述所有点、然后描述所有面的点的索引。  
这样好描述结构、但不好进行拓扑修改。

包含：

* point records
* half edge records  
  半边的信息会很多。包含各半边的前驱和后继信息（可以用指针；也可以用数组索引（优点是内存连续、缺点是不好删元素））。
* face records  
  但面的信息很少了，只用一个半边来描述。

应用：

* 求一个点附近所有的面  
  根据 point records，找到其所有半边，然后通过半边不断找后继得到各个面。