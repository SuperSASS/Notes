# Ep.3 进程

在分布式系统中进程如何体现。

## 一、线程

* 处理器：提供一组指令、并自动执行一系列指令的能力
* 线程：最小的软件处理器
* 进程

上下文：

* 处理器上下文：各种寄存器的集合
* 线程上下文：部分寄存器和内存的集合
* 进程上下文：用于线程的执行

## 二、虚拟化

虚拟化的重要性：

* 硬件变化快于软件
* 提高可移植性和代码迁移的便利性
* 隔离失效或受攻击的组件

原理：添加一层以**模拟下层接口**。

**级别**：

* 指令集级别：模拟 CPU
  * 特权指令：均允许操作系统调用
  * 普通指令：任何程序执行
* 操作系统：模拟操作系统的系统调用(syscall)
* 库：模拟应用程序编程接口(API)

**方法**：

* Process VM: 有一些指令、搭配一个解释器 / 模拟器，运行在操作系统之上
* Native VMM: 有很低级别（底层）的指令，加上最基本的精简操作系统
* Hosted VMM: 有低级别的指令，但大部分工作交给一个完整的操作系统来执行

**敏感**：

* 控制敏感指令
* 行为敏感指令

需要将这些指令在陷入操作系统时截住，才能进行模拟。  
但部分敏感指令并不会陷入操作系统。

**云服务**：

* IaaS: 即提供虚拟机(VM)或虚拟监视器(VMM)
* PaaS: 系统级服务
* SaaS: 实际应用程序

## 三、客户

* 应用层解决方案：只关心应用层之间的协议
* 中间件解决方案：中间件之间的协议

例 - X Window:

* X lib: 提供 api
* X kernel: 在用户终端显示图形界面的层
* X protocol: X lib 与 X kernel 通信协议 

## 四、服务器

基本模型：服务器上开一个进程 / 线程，对一个客户服务。

**类型**：

* 迭代服务器：处理完一个请求再处理下一个
* 并发服务器：使用一个调度器，接受传入的消息、传给单独的一个进程 / 线程处理

**客户端如何联系 - 端口**：  
大多数服务都绑定到一个特定的端口。

**带外通信**：

有时候可能存在一些紧急（优先级）的信息，一般再开个端口，用于处理优先信息。

**状态**：

* 无状态服务器：不记录任何客户端的准确信息
  * 表现
    * 不记录文件是否已被打开
    * 不保证客户端缓存无效
    * 不跟踪服务器
  * 效果
    * 客户端与服务器完全独立
* 状态服务器

**对象服务器**（容器）

## 五、代码迁移

**迁移模型**：

* CS: C 完全没任何东西，只获得 S 上的结果
* REV(Remote evaluation): C 有代码、没运行环境，传到 S 上运行得到结果
* CoD(Code on Demand): C 有环境资源，代码在 S 上，S 把代码传到 C 上执行
* MA(Mobile agents): C 有代码、环境、资源，但为了更快执行，放到 C 上

**流动性强弱**：

有三个需要迁移的对象组件：代码、数据、状态

* 弱移动性：仅移动代码和数据段
* 强移动性：移动组件、包括执行状态

在异构系统的迁移，唯一的解决方法：实现自己的抽象机器。  
如解释性语言（有自己的虚拟机）、VMM。
