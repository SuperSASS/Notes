# Ep.4 系统概要设计

需求阶段确定系统“做什么”，概要设计确定系统“总体怎么做”。  
问题结构（软件需求）在该阶段映射为软件结构。

## 一、任务

### 1. 设计的要素

* 体系结构设计：拆分软件，分解为几个小的子系统，子系统中分解为模块
* 接口：分开的功能模块之间的接口，输入什么输出什么
* 数据结构：公共的数据库

三者都是公共的，属于概要设计的部分。

后面的“人机界面”和“构件”则属于“详细设计”部分。

### 2. 概要设计的内容

* **软件体系结构设计**：选择适用于需求的**软件体系结构风格**，开展软件物理架构、逻辑架构设计。  
  如何以最佳的方式划分一个系统，是标识组件、组件通信、信心沟通、系统元素独立的保障。
* **接口设计**：接口是类、构件或其它类（包括子系统）的**外部可见的操作说明**，而不管内部。
* **数据设计**：确定软件设计的文件系统的结构，数据库的模式和子模式，进行数据完整性和安全性的设计。

## 二、工程过程

上面提到了三个方面的设计，可分解为9个活动（过程）。

1. **制定规范**：需要制定的标准和规范，包括
   * 设计文档编址标准
   * 信息编码格式、硬件、操作系统的接口规约
   * 设计目标、原则
2. 系统体系结构设计 - **物理架构设计**  
   可由部署图体现。
   * 系统分解为具有独立任务的子系统
   * 分析子系统之间的通信、确定子系统的外部**接口**
   * 确定子系统的软硬件**环境**、网络环境、数据环境
   * 系统的物理**部署**、优化设计
3. 软件体系结构设计 - 逻辑结构设计  
   可由体系结构图体现。
   * 确定子系统的**模块**元素
   * 确定模块间的调用和返回关系
   * 根据需求定义每个模块的功能
   * 评估软件质量，进行结构优化
   * 定义模块结构及接口数据结构
4. 公共数据结构设计
   * 公共数据变量的数据结构、作用范围
   * 输入输出文件结构
   * 数据库中表结构、视图结构、数据完整性
5. 安全性设计（一般只指信息数据安全，软件安全很难）  
   * 日志、权限、加密
6. 故障处理设计
   * 软硬件的故障、进行备用设备、出错处理、数据备份等
7. 可维护性设计  
   设计系统监测模块，用于系统的改进  
8. 编写概要设计报告
   * 概要设计说明书
   * 数据库设计说明书
   * 测试初步计划
9. 概要设计评审
   * 需求确认
   * 接口确认
   * 模块确认：高內聚低耦合，约束在作用范围内
   * 风险性
   * 可维护性
   * 质量

后面的一些日志、故障处理这些虽然感觉像模块，像详细设计，但因为是**公用**的，所以可放在详细设计中，作为“横切关注点”。

## 三、软件设计原则

### 1. 抽象与逐步求精

**抽象：**

* 基本策略：在软件设计的规模逐渐增加的情况下，控制复杂性。
* 过程：
  * 从特殊到一般
  * 上层概念是下层概念的**抽象**
  * 下层概念是上层概念的**精华和细化**
* 分类：
  * 过程抽象（功能抽象）：任何一个完整定义的功能都可以作为一个模块
  * 数据抽象：`ADT`【误……

**逐步求精：**

把问题的求解过程分解成若干步骤或阶段，  
每步都比上步更精化，更接近问题的解法。

*如状态机图可以体现。*

### 2. 模块化

软件体系结构是软件模块（构件）之间关系的表示，决定系统的结构和质量。

> 概念 - 模块：
>
> 模块是数据说明、可执行语句等程序对象的集合，是单独命令的，并可以通过名字(ID)来访问。  
> 例如：过程、函数、子程序、类、构件。

模块化就是软件按照规定原则，划分为一个个小的、但互相有关联的模块。

模块化存在以下原因：

* 问题越复杂，解决问题花费越多
* 解决**单个问题**，比解决这些问题**组合起来的复杂性更低**

但模块化不能像数学一样，能无限划分下去，  
由于模块结合起来需要额外开销，故**模块要适中**。

### 3. 信息隐藏

信息要为直接使用类开放。  
类存在上下级层次，最好**不要越级操作**，从而实现信息隐蔽，避免高耦合导致级联修改。

* 信息专家原则：把职责（函数调用等）分配给直接相关类中
* 创建者原则：把类的初始化放在直接使用类
  * A类组合B类：B是A的成员，且B不能离开A单独存在（躯体组合成人）
  * A类聚合B类：B是A的成员，但B可以独立存在
  * A类记录B类：B不是A的成员，但却是A的某个集合成员的元素
  * A类紧密使用B类

### ⭐4. 独立性原则

指每个模块指完成系统要求的**独立的子功能**，并且与其他模块的**联系最少**且**接口简单**。

**衡量指标：**

* 内聚度：功能模块**内部**，各个元素彼此**紧密结合**，内聚度越高越高  
  内聚程度从低到高：
  * 偶然内聚：内部个元素几乎没有联系，是松散的
  * 逻辑内聚：执行几个逻辑上相似的功能，通过**参数**确定该模块完成哪一个功能  
    修改模块公用代码时，另一些模块会被影响；同时模块其他不用的地方会加载到内存，浪费
  * 时间内聚：把需要同时执行的组合在一起形成的模块
  * 过程内聚：模块内部的处理是相关的，必须以**特定顺序**执行（但不一定是在同一功能内）
  * **通信内聚**：模块内所有的处理元素都在**同一个数据结构**上操作，或有相同的数据输入（使用**数据、上下文**一样）
  * **顺序内聚**：类似过程内聚，但指一个模块各种处理元素都**紧密相关于同一功能**、且必须顺序执行，前一个功能元素的**输出作为**下一个**输入**
  * **功能内聚**：模块内所有元素共同完成一个功能，**缺一不可**（组合关系）
* 耦合度：模块**之间**相互**关联**的程度，是否**独立、结构简单**，耦合度越低越好  
  耦合程度从高到低：
  * 内容耦合：这个模块会直接访问另一个模块内部的东西，直接886
  * 公共耦合：数据结构级的耦合，两个模块**使用同一个对象、数据**，最好合并到一个模块
  * 外部耦合：两个功能模块访问了同一个全局变量（上下文？）
  * 控制耦合：模块与模块之间传递的是**控制变量/信息**，就是传过来的参数，会在模块中起控制作用（比如`if`/`switch`）。
  * **对象耦合**：模块之间**有调用/引用**关系，但传递的是对象，相当于**引用**模型传递
  * **数据耦合**：模块之间**有调用/引用**关系，但传递的只是**数据值**（而不是数据引用），相当于**值**模型传递
  * **间接耦合**：两个模块完全**没有直接关系**（互相不调用），联系之通过主模块（相当于控制总线，服务容器等）的控制和调用间接实现

**原则：**

* 高度相关的功能模块或类，采用相对耦合度较高的方法连接（如继承、引用），实现高內聚
* 功能差异大的，采用耦合度低的方法