# 第二节 Multiprocessor Scheduling - 多核处理器调度

## 一、Multiprocessor and Multicore Scheduling - 多处理器与调度

多处理器系统分为以下三类：

* Loosely coupled/Distributed Multiprocessor, Cluster - 松耦合、分布式多处理器、集群
* Functionally specialized processors - 专用处理器
* Tightly coupled multiprocessor - 紧耦合多处理器

### 1. Granularity - 粒度

描述进程之间的同步度（并行性）
划分成五种粒度：

1. Fine - 细
2. Medium - 中等
3. Coarse - 粗
4. Very Coarse - 极粗
5. Independent - 无约束

#### (1) Independent Parallelism

#### (2) Coarse/Very Coarse-Grained Parallelism

#### (3) Medium-Grained Parallelism

线程级并行。

交互非常频繁

#### (4) Fine-Grained Parallelism - 细粒度并行性

指令级并行。

### 2. Design Issues - 设计的问题

涉及三个问题：

* Assignment of processes to processors.  
  如何把进程分配到处理器。
* Use of multiprogramming on individual processors.  
  在每个处理器上如何管理多个进程。
* Actual dispatching of a process.  
  
所用方法取决于两个指标：

* 粒度级
* 可用处理器数量。

#### (1) 把进程分配到处理器

若处理器结构统一、性能一致，  
则可以将所有处理器视为一个资源池，按照要求将进程分配到相应处理器。

两种分配方式：

* Static - 静态分配：  
  进程一旦分配到某个处理器，则不会再变化。
* Dynamic - 动态分配：  

针对分配程序（操作系统）所分配的处理器，有两种方式：

* Master/Slave Architecture - 主从式结构  
  OS的核心功能总运行在某个特定的处理器上。
* Peer Architecture - 对等式结构  
  OS能在任何一个处理器上执行。

### 3. Processor Shceduling - 进程调度

多核处理器，因为各调度算法性能差不多，采用FCFS。

### ⭐4. Thread Scheduling - 线程调度

四种方法：

* Static
  * Load Sharing - 负载分配
  * Dedicated
  * Gang Scheduling
* Dynamic

#### (1) Load Sharing - 负载分配

对线程的选择，  
三种方法：

* First-come-first-served (FCFS)
* Smallest number of threads first
* Preemptive smallest number of threads first

缺点：

* 进程切换更加复杂

#### (2) Gang Scheduling - 组调度

分配了组，不能在所有处理器上游走。

介于两者之间。

#### (3) Dedicated Processor Assignment - 专用处理器调度

最大程度利用线程的并行。  
最浪费资源。

图：  
在8之前，都能利用，增加；8之后，性能下降。

#### (4) Dynamic Scheduling - 动态调度

应用也参与了调度决策。

## 二、Real-Time Systems - 实时系统

实时计算现在越来越重要，而操作系统的调度程序是其中最关键的部件。

正确性的评价来源于两个方面：

1. 逻辑结果正确
2. 时间控制

分为两种实时：

* Hard real-time task - 硬实时  
  如果不能在规定时间(deadline)内完成，会带来不可接受的损失。
* Soft real-time task - 软实时  
  虽然也有deadline，但要求不那么严格。

实时任务另一个特征是周期性，  
周期性任务要求“每$T$个单位执行一次”。  
非周期性任务需要明确规定起止时间。

### 2. 特点

#### (1) 可确定性

#### (2) Responsiveness - 可响应性

从作业到达到第一次执行（响应）的时间。
与中断机制有关。

#### (3) User Control - 用户控制

用户有更多控制的权限

#### (4) Reliability - 可靠性

必须要保证系统的可靠性，  
否则会发生灾难性的后果。

#### (5) Fail-Soft Operation - 故障弱化操作

有一些容错机制。

### 3. Real-Time Scheduling - 实时系统调度

只是分析有没有可能被调度，为可调度性分析(Schedulability Analysis)。  
当分析完后，得到一个调度计划(Scheduler Plan)。

有以下方法：

1. 静态表调度法
2. 静态优先级抢占调度法
3. 基于动态规划的调度法
4. 动态尽力调度法

### 4. 期限调度

最关注的是deadline。

有以下关注的信息：

* Ready Time
* Starting deadline - 启动最后期限
* Completion deadline - 完成最后期限
* Processing time - 处理时间

最基本的元素：周期$T$和服务时间$C$，  
可能还有完成最后期限$D$。

### 5. Rate Monotonic Scheduling (RMS) - 速率单调调度

是一种优秀的处理周期性任务中多任务调度冲突的方法。

到达速率越快，优先级越高。
