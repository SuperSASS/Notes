# Files

有关I/O只讲文件。

数据具有的特性：独立与程序保存，  
且要将数据“永久”地存储下来。

一个字节流或信息流的集合。


* Data collections created by users.  
   由用户创建的一个“数据包”。
* The **File System** is one of the most important parts of the OS to a user.  
   文件系统是操作系统作用要的部分之一。  
   其用来管理文件的存储方式、组织结构、读取等。

Properties - 特点：

* Long-term existence - 长期存储  
  * Stored on disk or other secondary storage.  
    存储在磁盘或其他外部存储设备
  * Do not disappear when a user log off.
* Sharable between processes - 进程间共享  
  * Files have name.
  * Can shared.
* Structure - 文件结构
  * Files can be organized into hierarchical or more complex structure to reflect the relationships among files.  
    要组织成层次或更复杂结构，以反映文件间的关系。

## 一、Files System - 文件系统

Provide a means to store data organized as files as well as a collection of functions that can be performed on files.  
提供一个方法来存储组织成文件的数据，就像用一个功能集合来操作文件。

Maintain a set of attributes associated with the file.  
保持文件具有的特性。

Typecal operations - 操作：

* Create
* Delete
* Open  
  与真实的打开不同，只是放个索引表。
* Close
* Read
* Write

## 二、File Structure - 文件结构

信息不断打包，如下顺序：

* Field - 字段
  * Basic element of data, contains a single value.  
    数据的最基本单位，包含单个的值
  * Fixed or variable length.  
    有定长或变长。
* Record - 记录
  * Collection of related fields that can be treated as a unit by some application program 
    相关字段的独立集合，被一些应用程序作为一个整体。
  * Fixed or variable length.
* File - 文件
  * Collection of similar records, treated as a single entity.  
    相关记录的集合，被当作单独的实体。
  * May be **referenced by name**.  
    通过**文件名**来区分。
  * **Access control** restrictions usually apply at the file level.  
    **访问控制**一般就在文件这一层级应用。
* Database - 数据库  
  * Collection of related data.  
    相关数据的几何
  * Relationships among elements of data are explicit.  
    数据之间的关系很明确清楚。
  * Designed for use by a number of different applications.  
    被设计用于让多个应用程序使用。
  * Consists of one or more types of files.  
    多个文件的集合。

## 三、File Management System - 文件管理系统

### 1. Objectivs - 目标

* Meet the data management needs of the user.  
  满足用户对数据管理要求。
* Guarantee that the data in the file are valid.  
  确保在文件里的数据有效。
* Optimize performance.  
  最优化性能。
* Provide I/O support for a variety of storage device types.  
  对各种存储设备类型提供输入输出支持
* Minimize the potential for lost or destroyed data.  
  最小化潜在的丢失损坏数据的可能。
* Provide a standardized set of I/O interface routines to user processes.  
  提供标准化的输入输出接口给用户进程。
* Provide I/O support for multiple users in the case of multiple-user systems.  
  对多用户的输入输出提供支持。

**有关第一点：**

* Minimal User Requirements - 最小需求：
  * Should be able to create, delete, read, write and modify files.  
    可创建删除读取写入修改文件。
  * May have controlled access to otjer users' files.  
    能控制访问权限。
  * May control what type of accesses are allowed to the files.  
    能控制访问具体的访问权限（只读、可写等）
  * Should be able to restructure the files in a form appropriate to the problem.  
    能根据面对的问题重构文件成适合的格式。
  * Should be able to move data between files.  
    能够在文件中移动数据
  * Should be able to back up and recover files in case of damage.  
    为了预防损失，可以备份和恢复。
  * Should be able to access the files by name ratjer than by number.  
    能够用文件名访问，而不是数字ID。
    
### 2. Typical software Organization - 典型的软件组织

* User Program
* Pile 堆 / Sequential 顺序 / Indexed Sequential 索引顺序 / Indexed 索引 / Hashed 哈希
* Logical I/O
* Basic I/O Supervisor - 基础输入输出管理器
* Basic File System - 基础文件系统
* Disk Device Driver / Tape Device Driver - 驱动程序  
  分为磁盘和磁带的驱动（磁带基本已被废弃）

#### (1) Device Drivers - 设备驱动

* Lowest level
* Communicates directly with peripheral devices.
* Responsible for starting I/O opeartions on a device.
* Considered to be a part of OS.

#### (2) Basic File System - 基础文件系统

也被称为"Physical I/O level"（物理输入输出层）

* Primary interface with the environment outside the computer system.
* Deals with blocks of data that are exchanged with disk system.
  在磁盘系统中交换数据。
* Concerned with buffering blocks in main memory.  
  考虑存放在内存中的缓冲块。
* Concerned part of the OS.

#### (3) Basic I/O Supervisor - 基础输入输出监控器

* Responsible for all file I/O initiation and termination.
  负责对所有文件的初始化和结束。
* COntrol structures tjay deal with device I/O shceduling and file status are maintained.
* Selects device on whick I/O is to be performed.  
  选择在哪个设备上处理
* Concerned with scheduling.  
  考虑文件的调度
* I/O buffers are assigned and secondary memory is allocated at this level.

#### (4) Logical I/O

* Enables users and applicatipons to access records.  
  允许用户和应用访问记录。
* Provides general-purpose record I/Ocapability．

**访问方法：**

* Level of the file system closest to the user.  
  离用户最近的层。
* Provides a standerd interface  between applications and the file systems and devices that hold the data.
* 不同文件结构，获取处理数据、访问方式不一样。

### 3. File Organization and Access

File organization is the logical structuring of the records as determinaed by the way in which they are accessed.

选择组织结构的时候，要考虑下面的方面：

* Short access time
* Ease of update
* Economy of storage
* Simple maintenance
* Reliability

所组织的具体结构见下物种。

拓展：还存在一种“无结构”的结构，  
此类文件一般就是存二进制，是**字节流**。
如`.exe`，其就是一种没有结构的二进制文件。

#### (1) Pile - 堆

* 复杂度最低的文件组织形式。
* 按照数据到达顺序来组织。
* 每个记录拥有一系列爆发(brust)的数据
* 目的：简单地收集大量的数据并保存，就是只存下来。  
  因此在查找的时候效率低下。

#### (2) Sequential - 顺序文件

相较于堆时直接堆上去，  
这里将格式统一后再堆上去。

* 最常见的文件结构
* A **fixed format** is used for records.  
  每个记录的格式固定
* **Key filed** uniquely identifies the records.  
  唯一的关键域用来标识文件。
* 常用在批处理程序。
* Only organization that is easily stored on tape as well as disk.  
  容易存在磁带或磁盘上。【？？

#### (3) Indexed Sequential File - 索引顺序文件 c

相较于顺序，多了索引。

#### (4) Indexed File - 索引文件

* 存在索引文件
* 对感兴趣的内容可以建立次索引

#### (5) Hashed File - 哈希文件

根据索引的Key Value， 做哈希操作。

在超高速要求的喜用常用。

### B-Trees

用于组织索引，  
提供了有效的增删查的方法。