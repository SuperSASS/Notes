# Ep.6 关系数据库设计

关系模式中存在**数据依赖**。

对于联合主键，部分字段可能并不是由这个联合主键所决定，  
而是由其中某一个主键决定，导致数据出现异常。

* 数据依赖
  * **函数依赖**
  * 多值依赖
  * 连接依赖

解决异常方法：对关系模式进行相应的**分解**，使其符合相应的范式。

## 一、函数依赖

### 1. 定义

对于函数$y=f(x)$，可以说$x$函数决定$y$，也可以说$y$函数依赖于$x$。  
关系数据库中讨论函数或函数依赖，注重的是**语义**上的关系。

如$省=f(城市)$，只要给出具体城市，就有唯一的省与之对应。

把$Y$依赖于$X$表示为$X\to Y$。

> 定义 - 函数依赖：
>
> 若有一个关系模式$R(A_1,A_2,\cdots,A_n)$，$X$和$Y$为其子集，$r$是$R$中任意具体关系，$t_1,t_2$是$r$中任意两个元祖。  
> 如果由$t_1[x]=t_2[x]$推导出$t_1[y]=t_2[y]$，则可以推导出$Y$依赖于$X$，即$X\to Y$。

### 2. 基本术语

* 平凡函数依赖：$X\to Y$，但$Y\not\subset X$，则$X\to Y$为非平凡的函数依赖。  
  一般不讨论该种依赖。
* 完全函数依赖：对于$X$的任意子集$X'$，其都有$X'\not\to Y$，则称$Y$完全依赖于$X$，记作：$X\xrightarrow{f}Y$
* 部分函数依赖：有$X'\to Y$，记作：$X\xrightarrow{P}Y$
* 传递函数依赖：$X\xrightarrow{f}Y\xrightarrow{f}Z$
* 等价：$X\to Y$并且$Y\to X$，记作$X\leftrightarrow Y$（在$1:1$关系中体现）

### 3. 最小函数依赖集

最小函数依赖集：如果某个函数依赖可以由其他依赖推导出来，或者微部分函数依赖，便可以转化成最小函数依赖集。

方法：

* 用分解的法则：若右侧有多个，分解为一个。
* 去掉多余的函数依赖
* 去处复合函数依赖

闭包：该属性推导出的最大的属性集合，记为$(X_{+})=...$

## 二、关系规范

### 0. 基本概念

* 候选键
* 主属性
* 非主属性

### 1. 第一范式 - 1NF

需要满足：每行每列的交叉处**只有一个值**。

关系的最基本要求，否则不叫关系。

### 2. 第二范式 - 2NF

在满足第一范式的基础上，若关系的主键有多个类型构成的复合主键，则需要：非主属性对非主键不存在部分函数依赖。

因此若主键只有一个属性，则一定是NF2。

转换方法 - 分解：  


消除非主属性的部分函数依赖。

### 3. 第三范式 - 

在第二范式的基础上，所有的非主属性都不属于