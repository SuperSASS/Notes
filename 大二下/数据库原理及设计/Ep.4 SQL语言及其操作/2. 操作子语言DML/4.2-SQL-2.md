# 第二节 操作子语言DML

定义好各种数据结构和约束后，便可开始使用该数据库，  
向其“**增删查改**”各种数据。

关键命令：

* `INSERT`
* `UPDATE`（注意与DDL中`ALERT`不同）
* `DELETE`
* `SELECT`

## 一、数据插入 - INSERT

插入一行：

```sql
INSERT [INTO] <表名或视图名>[(属性名序列)]
  VALUES (一行中各列的值)
```

插入多行：

```sql
INSERT [INTO] <表名或视图名>[(属性名序列)]
  SELECT ... /* SELECT产生的表，只能是表！ */
```

如要从别的表里插入数据，则`SELECT`这张表所需的数据（可以加上`WHERE`筛选），  
如要直接插入多条数据，则可以用`UNION`，将若干个条数据相并组成表。

> e.g. 直接插入多条数据
>
> ```sql
> INSERT  t(tname,title)    ​
> select  'Zhang','Lecturer'  Union  ​
> select  'WANG','Lecturer'  Union ​
> select  'LI','Lecturer'
> ```

## 二、数据修改 - UPDATE

```sql
UPDATE ​{ 表名 [ WITH (<表更新选项>[ ...n ]) ] | 视图名 } ​
  SET { 列名 = {表达式|DEFAULT|NULL}[,...n ] }
  [FROM { <源表> }[ ,...n ]] ​/* 修改的时候要如果带了条件WHERE，且WHERE中有别的表，这个FROM就不能省略 */
  [WHERE <条件表达式> ] /*​ 修改的条件，如只能修改某人的属性 */
```

注： <表更新选项>是加锁控制，在之后讲解。

## 三、数据删除 - DELETE

与`UPDATE`形式一致，  
都是先找出`SELECT`满足条件的元组，再修改/删除。

删除一次只能删除一个表的数据，  
只是条件可以跨表。

> e.g. 1 - 删除数据
>
> ```sql
> DELETE 
>   FROM SC ​
>   WHERE Cid IN ( SELECT Cid  FROM C WHERE Cname = 'Maths' ) 
> ```

## 四、数据查询 - SELECT

```sql
SELECT 列表  [ INTO  新表名 ]  FROM <源表>​
    [ WHERE 条件表达式 ]    ​
    [ GROUP BY 分组表达式 ] ​
    [ HAVING  组内数据条件表达式 ] /* 对分组统计后的数据再筛选 */​
    [ ORDER BY  排序表达式 [ ASC | DESC ] ] ​
    [ COMPUTE ​
      {{AVG|COUNT|MAX|MIN|SUM}(表达式)}[,...n] ​
      [ BY expression [ ,...n ] ]] /* 对排序结果进行小计 */
```

### 1. SELECT 子句

```sql
SELECT [ ALL | DISTINCT ]  < select_list >  ​

< select_list > ::= ​
  { * | 
   { 表名 | 视图名 | 表别名 }.* ​ |
   { 列名 | 表达式} [ [ AS ] 列别名 ] |
   列别名 = 表达式 } [ ,...n ] 
```

* ALL表示重复行可出现于结果中，DISTINCT则去除重复元素（相当于关系代数）。  
  ALL为缺省情况。
* `*`表示FROM子句的表、视图中的所有列均出现于结果中，其顺序遵照表、视图中的顺序。
* 表达式中可用聚集函数。

### 2. INTO 子句

作用：  
创建一张与`SELECT`的表同构的新表，并将查询结果插入。

* `SELECT ... INTO`不能与`COMPUTE`一起使用。
* 可用`SELECT ... INTO`创建一张与`FROM`子句中的表具有相同结构的、属性名相（不）同的新表。  
  如果不需要数据，可令`WHERE`子句条件为永假即可（此时该表可用作备份等）。

### 3. FROM 和 WHERE 子句​

`FROM`子句作用：  
指定在`SELECT`、`DELETE`及`UPDATE`语句中，所用的表、视图及表连接等。

`WHERE`子句作用：  
指定**限定行**的查询条件。

* 算术比较符：=、<、>、<=或!>、>=或!<、<>或!=​
* 逻辑运算符
  * `AND`
  * `OR`
  * `NOT`​
* 特殊运算符
  * `(NOT) IN`
  * `BETWEEN ... AND ...`
  * `(NOT) LIKE`
    > 补充 - 对于`LIKE`模糊查询：
    >
    > * `%` - 匹配任意一串字符
    > * `_` - 匹配任意一个字符
    > * `[]` - 取其中任意单个字符
    > * `^` - 非，用在`[]`中组成不取其中当个字符`[^ABC123]`
    >
    > 若要把这几个字符当作匹配符，则用转义字符`%`。
  * `IS (NOT) NULL`
  * `SOME`
  * `ANY`
  * `ALL`
  * `(NOT) EXISTS`
    > 补充 - 对于`EXSITS`的用法：
    >
    > 检查子查询中是否有结果（存在任意一行），有则True。
