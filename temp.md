# 裁剪

## 直线裁剪

### 编码裁剪

特点：

* 用编码方式可以快速判断线段完全可见和显然不可见。
* 使用两种场景：大窗口场合、窗口特别小场合（如光标拾取对象，光标看作特别小的裁剪窗口）

### 中点分割裁剪算法

在编码裁剪算法上改进，  
用编码快速判断是否完全在内或完全在外，  
对于与窗口相交部分，则利用求中点，用中点逼近线段与窗口交点的方法，代替乘除法实现求交点。

对于求中点来说很容易，是两端点坐标和右移1（除2）。

**方法：**  
不断求线段的中点，并将中点作为新的端点再求交点，直到

### 梁友栋-Barsky裁剪算法

用参数$u$表示线段方程，在$0\sim1$取值，  
$u=0$时，该点为$P_1(x_1,y_1)$，$u=1$时，该点为$P_2(x_2,y_2)$。

**步骤：**

* 初始化参数$u_1=0$、$u_2=1$


## （多边形）区域裁剪

裁剪特点是：保持窗口内多边形的边界部分

### 1. 逐边裁剪法

每次用窗口的一条边界，去裁剪多边形顶点序列，  
顺序的测试多边形各顶点：保留边界内侧的顶点，删除外侧的顶点，适时地插入新的顶点（交点和窗口顶点），从而得到新的多边形顶点序列。  
依次进行，直到四条边界线均进行裁剪，输出现在的顶点序列。

**产生规则：**

以窗口的一条边以及延长线构成的裁剪线，该线平分平面为两部分：  
一部分包含窗口称为可见一侧；另一部分称为不可见一侧。  
按照顺序处理端点序列的两端点$SP$。

$SP$与边界延长线存在以下关系：

* $S$在外侧，$P$在内侧 - 交点$l$、当前点$P$保存到新多边形中
* $S,P$均在内侧 - 当前点$P$保存到新多边形中
* $S$在内侧，$P$在外侧 - 交点$l$保存到相信多边形中
* $S,P$均在外侧 - 不保存点

**问题：**

* 对于凸多边形：裁剪结果正确
* 对于凹多边形：可能会在沿窗口边界产生多余线段。

> 定义 - 凹多边形：
>
> 将一边延长，图形在直线两侧都有。

### 2. 双边裁剪法

被裁减多边形称为主多边形，记为$A$；裁剪窗口称为裁剪多边形，记为$B$，  
两者均可以是任意多边形。

* 内裁剪：$A∩B$
* 外裁剪：$A-B$

**实现方法：**

各多边形的外部边界取顺时针方向，内部边界或孔取逆时针方向，  
如果$A$与$B$有交点，则交点必定成对出现，分为两类：

* 进点：主多边形边界由此进入裁剪多边形内
* 出点：主多边形边界由此离开裁剪多边形内

**算法步骤：**

* 规定顺时针顺序，初始化主多边形$A$和裁剪多边形$B$的顶点表。
* 依次处理主多边形各边，把两个交点$I_iI_{i+1}$加入到对应位置
* 再处理裁剪多边形的
* 从主多边形表的$I_1$开始，依次向下匹配最近的出点，然后转移到裁剪多边形表的该出点$I_2$，再向下匹配，  
  反复交换，直到匹配回$I_1$，完成第一个序列。
* 继续搜索主多边形表，看是否有未被遍历到的，有则从该点出发继续上述步骤。

**问题：**

* $A$的边与$B$的边重合：不做计算。
* $A$的顶点在$B$的边上：
  * 顶点落在裁剪多边形边上的主
  * ？

## 字符裁剪

* 笔画精度  
  * 点阵字符，构成字符的像素在窗口内才显示
  * 矢量字符，按直线或多边形裁剪方式裁剪
* 字符裁剪
  * 字符一部分超出窗口，则不显示该字符
* 字符串裁剪
  * 字符串一部分超出窗口，则不显示该字符串
