# LaTeX3学习笔记

## 零、基础概念

可能经常听到的一些名词：

* 控制序列：就是用`\`加一串字母或一个符号（空格）组成的一个命令。  
  如`\sin`、`\;`。
* 凭据(Token)/凭据表(Token List, tl)：  
  键入TeX文件中的所有内容都可以视作凭据表，其内部有三类对象：
  * 字符：如`a`/`b`/`c`（注意：`abc`算三个Token）
  * 控制序列（命令）：如`\abc`
  * 凭据表：即`{ ... }`，凭据表即是用花括号括起来的内容。
    故凭据就是字符和控制序列。

## 一、什么是LaTeX3

首先$\LaTeX$，总的来说是为了文档的编写与排版的，  
但只有排版不一定够，还需要一些模块化、自动化设计，能让文档支持一些插件，  
如果网页一样，编写是HTML、排版是CSS，但还需要实现功能的JS。

传统的LaTeX实际上支持一定的编程语法（变量、控制语句等），但很繁琐，  
$LaTeX3$则是封装简化了这些语法，并且提供统一的接口（也就是不用再包含各种包了）。

**原LaTeX的问题：**

* 变量和函数同类：都是控制序列，都用同样的方式声明。  
  如：变量`\newcommand{\A}{...}`；函数`\newcommand{\B}[1]{#1...}`。  
  *【我觉得倒不如说本来就不存在变量这个概念，是需要用又没有，就把命令巧化为变量了x……*
* 宏展开控制问题：  
  LaTeX是宏语言，导致在递归调用时，不会进行宏操作。  
  如：定义一变量`\A`为`def`，用函数`\uppercase{abc\A}`时，结果为`ABCdef`。  
  同时如果将函数封装为`\B`，并让`\A`在之后改为`ghi`，则调用`\B`后结果为`ABCghi`，也就是值会跟随变（类似传地址）而不会保存（类似传值）。
* 命名混乱
* 不区分命名空间和公有私有  
  导致现在所有宏包几乎都修改了LaTeX2e内核的命令（即`\renewcommand`），LaTeX2e那边几乎不可能对内核东西进行修改。

## 二、LaTeX3命名法

针对“函数”和“变量”的命名方法。

虽然自己可以不遵从，但人家的API（包括声明个int变量）都是这么写的，  
所以自己最好也遵从吧。

**注意：LaTeX命名不准出现数字。**

### 1. 命令约定

LaTeX对变量命名做了些约定（或者说只是希望），  
不是严格的，但最好遵守。

#### (1) 模块和描述命名

变量和函数的命名都存在“<模块>_<描述>”这一部分，其中：

* 模块
  就是你这个类或宏包的名字，应该是用于防止重名的。
* 描述  
  就是变量的命名了，可以用`_`隔开。


#### (2) 公有私有

LaTeX3存在公有和私有的概念：

* 公有：一般用户可以修改、访问。
* 私有：一般用户不应该修改、访问。

但这并不是严格要求的（因为严格要求开销很大）只是约定，  
LaTeX那边相信所有人都能遵守这种约定的。


### 2. 变量命名

```tex
\<作用域 scope>_<模块 module>_<描述 description>_<类型 type> % 公有变量
\<作用域 scope>__<模块 module>_<描述 description>_<类型 type> % 私有变量
% 可将模块和描述，看作变量的真正命名
% e.g.
\l_MyClass_val_int % 相当于C#的 { public int MyClass_val; }
```

#### (1) 作用域

* 作用域
  * `l` - 局部变量
  * `g` - 全局变量
  * `c` - 常量（全局）
* 类型
  * `int` - 整形
  * `fp` - 浮点数
  * `str` - 字符串
  * `tl` - 凭据表
  * `seq` - 队列
  * `dim` - 尺度/长度

### 3. 函数命名

```tex
\<模块 module>_<描述 description>:<选项规范 arg-spec> % 公有函数
\__<模块 module>_<描述 description>:<选项管饭 arg-spec> % 私有函数
% e.g.
\__MyClass_fun:Nn % 相当于C#的 { private void MyClass_fun( arg1, arg... ); }
```

* 参数类型
  * `N` - 
  * `n`
  * `V` - 
  * 