# 第一节 部件级设计

详细设计目标：  
对每个模块（用例）内部工作的描述成为详细设计。

## 一、部件级设计任务

对软件体系结构中的部件（构件、连接件等）进行详细设计。

> 部件在不同设计方法中的名称：
>
> * 结构化分析和设计方法 - 模块
> * 面向对象分析和设计方法 - 类或构件

* 在接近代码的抽象级上，表示内部数据结构和每个构件的处理细节。
* 定义内部的**数据结构**、**算法**、**接口特征**和分配给每个软件构件的**通信机制**。

**步骤：**

1. **标识**出所有与问题域相对应的设计类，以及所有与基础设施域相对应的设计类。  
   比如纵向的各个模块，横切的各个服务。
2. **细化**所有不需要作为复用构件的设计类，详细描述实现细化需要的所有接口、属性和操作。  
   不需要作为复用构件，指的是那些不是公用的构件（如日记、权限），对于这些公用构件可直接复用而不需要设计。
   1. 在类和构件**协作**时说明消息的**细节**。
   2. 为每个构件确定适当的**接口**。
   3. 对**类内部**设计，细化**属性**(Property)，并且定义实现属性所需要的数据类型和数据结构。  
      如果某一属性重复出现，可作为单独的类。
   4. 详细描述每个**操作**中的**处理流**。可能用伪代码或者UML活动流图表达。
3. 说明**持久数据源**（数据库和文件）并确定**管理数据源**所需要的类。  
   数据库和文件通常凌驾于单独的构件设计之上，需要类来管理。
4. 细化**部署**图以提供额外的实现细节。  
   对执行的硬件和使用的操作系统环境加以说明，确定构件包在这个环境中的位置。
5. 考虑每个构件级设计表示，并且时刻考虑其他可选方案。  
   在每次迭代中设计更精确。

## 二、基本设计原则

遵守部件设计的基本原则，使得产生的设计在发生变更是能够适应变更并且减少副作用的传播。

* **开闭原则**：软件实体对扩展是开放的，对修改是关闭的。  
  对功能扩展很容易，但尽可能少的修改既有的代码或功能。  
  在设计类时，应分析该类的稳定性，如果预期该类的修改会造成业务的大量变化，则应设计为单独的扩展。
  > 举例 - 花园种植水果的设计：
  >
  > 原本的设计：每一个水果一个类，有“种植”和“收获”方法，  
  > 在客户端中，一个个生成当前所有水果的实例，然后分别一个个调用。  
  > 如果增加新的水果，需要增加实例生成、调用方法三行代码。
  >
  > 改为接口实现方式：每个水果继承一个接口类，实现里面的“种植”和“收获”方法，  
  > 在客户端中，利用接口数组生成所有的水果实例，然后直接遍历调用。  
  > 如果增加新的水果，只需要在接口数组那增加新的水果。
* **职责单一原则**：就一个类而言，应该仅有一个引起它变化的职责，即一个类**只做一件事**。
* **依赖倒置原则**：预期有较大变化的类间依赖，应尽量**依赖于抽象**而不依赖于具体实现。  
  比起直接依赖若干个类，更适合把若干个类抽象为一个抽象类，然后依赖该抽象类。
* 组合/聚合复用原则：一个人可以由多个属性（角色）聚合。
* **里氏替换原则**(LSP)：将从基类到处的类传递给构件时，使用基类的构件应仁能够正确完成其功能。  
  子类在继承父类的时候，尽量不要重写父类的方法。
* **接口隔离原则**(ISP)：使用多个接口相互隔离，为客户端提供尽可能小的单一接口。  
* **迪米特原则**：一个类对自己依赖的类知道的越少越好。  
  也就是说，对于被依赖的类不管多么复杂,都尽量将逻辑封装在类的内部，对外除了提供的public方法，不对外泄露任何信息。
