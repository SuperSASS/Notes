# Ep.2 计算机图形系统

## 一、交互式计算机图形系统

### 1. 介绍

**功能：**  
![图 1](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--09-15_08-04-39.png)

**组成：**  
![图 2](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--09-15_08-06-25.png)  
（实验课中所用的`GDI`即属于图形支撑软件）

**其中图形设备分为：**

* 图形输入设备
  * 键盘
  * 鼠标
  * 光笔
  * 触摸屏/板（既可以输入也可以输出）
  * 手柄/操作杆
  * 跟踪球
  * 空间球（提供$6$个自由度，输入三维数据）
  * 数据手套
  * 数字化仪
  * 图象扫描仪
* 图形输出设备
  * 图形显示器
    * CRT（阴极射线管）显示器
    * 其他显示器
  * 图形硬拷贝设备
    * 绘图仪
    * 图形打印机
    * 其他设备

**分类：**

* 大型机为基础
* 中型或小型机为基础
* 工作站为基础
* 微型机为基础

### 2. 图形显示设备

1. CRT 显示器
   * 结构：  
     ![图 3](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--09-15_08-17-13.png)
   * 工作原理：电子枪发射电子束，经过聚焦系统、加速电极、偏转系统，轰击到荧光屏不同部位，被其内表面的荧光物质吸收，发光产生可见的光点。
   * 指标：
     * 最大偏转角：显示器长短与此指标有关。其越大，显示屏同等大小就越短。
     * 余辉时间（持续发光时间）
     * （物理）分辨率：水平或竖直方向单位长度上能识别的最大**光点个数**。  
       （逻辑）分辨率：尺寸一定，整个屏幕能容纳的光点个数。  
       物理分辨率$>$逻辑分辨率
     * 显示速度
     * **刷新**频率：让荧光物质保持稳定亮度值，需要控制电子束反复重复显示图形。频率则是每秒重绘屏幕的次数。
2. 彩色 CRT 显示器
   * 产生彩色的方法：
     * 射线穿透法
     * 影孔板法：象素位置上分布着呈三角形排列的三个荧光彩色点，三个荧光点分别发色红绿蓝光。  
   * 象素：指由R、G、B三种颜色充分靠近构成的一个点。

不同扫描方式：

1. 随机扫描显示器（矢量显示器）  
   电子束像一支快速移动的画笔，可随意移动，只扫描荧幕上要工作的部分。  
   只能画线图形，不能显示复杂图像。
2. 光栅扫描显示器  
   按固定的扫描线和扫描顺序进行扫描（如先从左到右水平回扫、再从上到下垂直回扫扫描）
   * 像素：构成屏幕的最小元素，整个屏幕被扫描线分为$n$行，每行有$m$个点，每点为一个像素。
   * 帧缓冲器（**显存**）：存放图形数据（扫描过程中哪些像素要被点亮）。  
     **计算方法**：分辨率*位面数bit（e.g. $1024\times768\times 24 \textrm{bit}$）
     * **双缓存技术**：一个缓存在刷新时，另一个缓存写入数据，两者在刷新完成后交换角色。  
     * 可用存放内容：
       * 颜色缓存：各像素颜色值。
       * 深度缓存（位平面数）：每个像素的深度值（位数）。
       * 累积缓存：用于生成运动模糊效果
       * 模板缓存：如游戏中的 UI。
       * 纹理存储
   * 数据表示：像素矩阵
   * 显示图形：几何属性+视觉属性，呈现真实感图形。
   * 逐行扫描/隔行扫描：隔行扫描先扫奇数行再扫偶数行扫描线，能降低闪烁降低成本，但图形效果变差。

屏幕上一个像素点，对应帧缓存中一组信息。  
**帧缓存存储像素颜色信息的方式**：

* 组合像素法：一个图形像素点全部信息被编码成一个数据字节，按一定方式存储到帧缓存中。  
  编码字节长度与点属性有关。
* 颜色位面法：整个屏幕像素矩阵作为一个位面，每个位面只存一位信息。多个位面组合起来，就能表达整个屏幕R、G、B电子枪的信息。  
  不同位面上同一像素地址中的内容，决定像素的颜色。  
  如24个位面，每一个颜色$8$个位面，则有$8$位，有$2^8=256$种强度，经过数模转换(DAC)，可以表达$256^3$种颜色，称为24位真彩色。
* 颜色查找表：帧缓存存储的不是像素本身颜色值，而是**彩色表**的一个**索引**（地址）。  
  颜色表为一个一维线性表，其元素个数即为颜色种数，内容则为该颜色的RGB。  
  在早期动画使用该方法，通过简单更改（如平移）帧缓存或颜色表，达到动态。

**⭐总结 - 帧缓存存储像素颜色信息方法：**

1. 直接存储像素颜色值（组合像素法、颜色位面法）
2. 存储像素在查色表中的索引值

### 3. 图形子系统

* 显示控制器：依据设定的显示工作方式，自主地、反复不断地读取帧缓存中的图像点阵数据，转换成RGB三色信号并配以同步信号送至显示器，可刷新屏幕。
* 显示处理器(GPU)：也称显示协处理器，把 CPU 从图形显示处理事务中解脱出来，主要任务是扫描转换待显示的图形以及某些附加的操作等。

![图 4](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--09-15_09-07-17.png)

### 4. 绘制流水线

图形子系统的图形绘制功能，常采用流水线结构绘制，或称管线绘制。

分为三个阶段：

* 应用程序阶段
* 几何阶段（显卡处理，但现在可以过程中加接口控制 GPU）
* 光栅阶段

![图 5](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--09-15_09-09-45.png)

经过最后的光栅阶段处理后，便由显示控制器读取输出。

## 二、计算机图形软件系统

### 1. 图形软件层次

1. 图形应用数据结构
   一组图形数据文件，存储欲生成图形的全部信息。  
   有对象的几何坐标数据、非几何熟悉（颜色、线型、纹理等），对象各部分之间连接关系，甚至还有专业属性。
2. 图形应用程序  
   完成作图或对图形进行各种处理；接受操作员的输入信息、包含用户界面的一些操作，从而构成一个功能完整的图形软件系统环境。
3. 图形软件包  
   是图形软件的核心，由许多**图形子程序**组成。在OS上建立了面向图形的输入输出、生成、坐标变换、修改等功能命令，以及系统调用和定义标准；形成图形标准。
4. 图形接口  
   把与设备无关的图形软件包与具体的图形设备隔离开来。如CGI。

### 2. 图形软件标准

![图 1](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--02-18_18-23-28.png)  
![图 2](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--02-18_18-23-46.png)

---

## 习题

**名词解释：**

* 像素：构成屏幕（图像）的最小元素。
* 分辨率
  * 物理分辨率：CRT在水平或竖直方向单位长度上 能识别的最大光点个数
  * 逻辑分辨率：整个屏幕所能容纳的光点数
* 光栅扫描：电子束按照固定的扫描线和规定的扫描顺序进行扫描
* 刷新频率：每秒钟重绘屏幕的次数  
  刷新：为了让荧光物质保持稳定的亮度需要控制电子束反复显示图形
* 点距：两个相邻光点中心的距离
* 帧缓存：存储要处理的图形数据信息，即存储屏幕上的像素的颜色值
* 颜色查找表：一维线性表，用来定义象素的颜色

**问题：**

1. 交互式计算机图形系统应具有哪些功能，结构如何？

   答：

   输入、输出、计算、存储、对话（交互）  
   ![图 1](images/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F--09-15_08-04-39.png)

   结构由图形软件、图形硬件组成。  
   图形软件包括：图形应用数据结构、图形应用软件、图形支撑软件；  
   图形硬件包括：图形计算平台、图形设备。
2. 计算帧缓冲器容量的方法

   答：

   1. 使用直接存储像素颜色值方法（如位面）
      $$
      V=N*M*B (bit)
      $$

      其中$N,M$是分辨率，$B$是位面位数，单位为`bit`
   2. 存储像素在查色表中索引值  
      e.g. 可以从$2^m$种颜色中任意选择$2^n$种作为同时显示的颜色
      $$
      V=N*M*n+2^n*m (bit)
      $$

      此时查色表的长度是$2^n$、宽度是$m$。
